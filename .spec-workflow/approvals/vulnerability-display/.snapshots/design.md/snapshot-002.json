{
  "id": "snapshot_1769923302444_qojr6nauj",
  "approvalId": "approval_1769923277261_jt1av1x00",
  "approvalTitle": "Design: Vulnerability Display",
  "version": 2,
  "timestamp": "2026-02-01T05:21:42.444Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Design Document: Vulnerability Display\n\n## Overview\n\nThis feature creates a new `VulnerabilityDisplay` component that replaces the raw JSON findings display in the Scanner component. It provides a categorized, visually appealing view of security findings with severity indicators, empty states, and transaction confirmation.\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n- **Card**: Existing UI component for container styling\n- **Badge**: Existing UI component for severity labels\n- **getRiskColor, getRiskLevelColor**: Existing utility functions in `lib/api.ts`\n- **lucide-react icons**: CheckCircle, AlertCircle, Shield, AlertTriangle, etc.\n\n### Integration Points\n- **Scanner.tsx**: Will import and use VulnerabilityDisplay component\n- **types/index.ts**: Will extend AuditFindings type to include credentials field\n- **AuditResult**: Existing type already has findings structure\n\n## Architecture\n\nThe design follows a component composition pattern where small, focused components are composed together.\n\n```mermaid\ngraph TD\n    Scanner[Scanner.tsx] --> VulnerabilityDisplay[VulnerabilityDisplay.tsx]\n    VulnerabilityDisplay --> FindingsCategory[FindingsCategory]\n    VulnerabilityDisplay --> TransactionConfirmation[TransactionConfirmation]\n    VulnerabilityDisplay --> EmptyState[VulnerabilityEmptyState]\n    FindingsCategory --> FindingItem[FindingItem]\n    FindingItem --> SeverityBadge[Badge component]\n```\n\n## Components and Interfaces\n\n### VulnerabilityDisplay Component\n- **Purpose:** Main container that orchestrates the vulnerability display\n- **File:** `components/ui/VulnerabilityDisplay.tsx`\n- **Props:**\n  ```typescript\n  interface VulnerabilityDisplayProps {\n    findings: AuditFindings;\n    riskLevel: RiskLevel;\n    transactionHash?: string;\n    paidAmount?: string;\n  }\n  ```\n- **Dependencies:** FindingsCategory, TransactionConfirmation, EmptyState\n- **Reuses:** Card, Badge from existing UI components\n\n### FindingsCategory Component (internal)\n- **Purpose:** Displays a single category of findings (malware, credentials, network, permissions)\n- **Props:**\n  ```typescript\n  interface FindingsCategoryProps {\n    title: string;\n    icon: React.ReactNode;\n    findings: string[];\n    color: \"green\" | \"yellow\" | \"orange\" | \"red\";\n  }\n  ```\n- **Dependencies:** FindingItem\n- **Reuses:** None (internal component)\n\n### FindingItem Component (internal)\n- **Purpose:** Displays a single finding with severity indicator\n- **Props:**\n  ```typescript\n  interface FindingItemProps {\n    finding: string;\n    severity?: \"LOW\" | \"MEDIUM\" | \"HIGH\" | \"CRITICAL\";\n  }\n  ```\n- **Dependencies:** None\n- **Reuses:** Badge component\n\n### TransactionConfirmation Component (internal)\n- **Purpose:** Displays payment confirmation with BaseScan link\n- **Props:**\n  ```typescript\n  interface TransactionConfirmationProps {\n    transactionHash: string;\n    amount: string;\n    network: string;\n  }\n  ```\n- **Dependencies:** None\n- **Reuses:** External link icon from lucide-react\n\n## Data Models\n\n### Extended AuditFindings\n```typescript\ninterface AuditFindings {\n  malware: string[];\n  credentials: string[];  // Added field\n  network: string[];\n  permissions: string[];\n}\n```\n\n### Category Configuration\n```typescript\ninterface CategoryConfig {\n  key: keyof AuditFindings;\n  title: string;\n  icon: React.ComponentType;\n  emptyMessage: string;\n  color: string;\n}\n\nconst CATEGORIES: CategoryConfig[] = [\n  { key: \"malware\", title: \"Malware Detection\", icon: Bug, emptyMessage: \"No malware detected\", color: \"red\" },\n  { key: \"credentials\", title: \"Credential Exposure\", icon: Key, emptyMessage: \"No credentials exposed\", color: \"orange\" },\n  { key: \"network\", title: \"Network Security\", icon: Globe, emptyMessage: \"No network issues\", color: \"yellow\" },\n  { key: \"permissions\", title: \"Permission Analysis\", icon: Shield, emptyMessage: \"No permission issues\", color: \"blue\" },\n];\n```\n\n## UI Layout\n\n### With Vulnerabilities Found\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ âœ“ Audit Complete                    ID: abc123         â”‚\nâ”‚   Payment successful - 0.05 USDC                        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚\nâ”‚ â”‚ Risk: 45/100â”‚ Level: MED  â”‚ Rec: CAUTIONâ”‚            â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ğŸ› Malware Detection                                    â”‚\nâ”‚   â”œâ”€ [HIGH] Suspicious eval() usage                     â”‚\nâ”‚   â””â”€ [MED] Dynamic code execution                       â”‚\nâ”‚                                                         â”‚\nâ”‚ ğŸ”‘ Credential Exposure                                  â”‚\nâ”‚   â””â”€ âœ“ No credentials exposed                           â”‚\nâ”‚                                                         â”‚\nâ”‚ ğŸŒ Network Security                                     â”‚\nâ”‚   â””â”€ [LOW] External API call to untrusted domain       â”‚\nâ”‚                                                         â”‚\nâ”‚ ğŸ›¡ï¸ Permission Analysis                                  â”‚\nâ”‚   â””â”€ âœ“ No permission issues                             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ğŸ’³ Transaction Confirmed                                â”‚\nâ”‚   0.05 USDC on Base Â· View on BaseScan â†—               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### No Vulnerabilities (Clean Scan)\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ âœ“ Audit Complete                    ID: abc123         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚\nâ”‚ â”‚ Risk: 0/100 â”‚ Level: LOW  â”‚ Rec: SAFE   â”‚            â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                    ğŸ›¡ï¸                                   â”‚\nâ”‚           No Vulnerabilities Detected                   â”‚\nâ”‚                                                         â”‚\nâ”‚   âœ“ No malware signatures found                         â”‚\nâ”‚   âœ“ No credential exposure detected                     â”‚\nâ”‚   âœ“ No suspicious network activity                      â”‚\nâ”‚   âœ“ No excessive permissions requested                  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ğŸ’³ Transaction Confirmed                                â”‚\nâ”‚   0.05 USDC on Base Â· View on BaseScan â†—               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Error Handling\n\n### Error Scenarios\n1. **Missing findings data**\n   - **Handling:** Display empty state with \"Unable to load findings\"\n   - **User Impact:** User sees a graceful fallback message\n\n2. **Invalid transaction hash**\n   - **Handling:** Hide transaction section, show payment amount only\n   - **User Impact:** User still sees payment confirmation without link\n\n3. **Malformed finding string**\n   - **Handling:** Display raw string without severity parsing\n   - **User Impact:** User sees the finding but without color coding\n\n## Testing Strategy\n\n### Unit Testing\n- Test VulnerabilityDisplay with various findings combinations\n- Test empty state rendering when all categories empty\n- Test severity badge color mapping\n- Test transaction link generation\n\n### Integration Testing\n- Test Scanner component integration with VulnerabilityDisplay\n- Test that findings from API response render correctly\n\n### End-to-End Testing\n- Complete audit flow showing vulnerability display\n- Verify transaction link opens correct BaseScan page\n",
  "fileStats": {
    "size": 9282,
    "lines": 202,
    "lastModified": "2026-02-01T05:21:10.380Z"
  },
  "comments": []
}