# Design Document: Vulnerability Display

## Overview

This feature creates a new `VulnerabilityDisplay` component that replaces the raw JSON findings display in the Scanner component. It provides a categorized, visually appealing view of security findings with severity indicators, empty states, and transaction confirmation.

## Code Reuse Analysis

### Existing Components to Leverage
- **Card**: Existing UI component for container styling
- **Badge**: Existing UI component for severity labels
- **getRiskColor, getRiskLevelColor**: Existing utility functions in `lib/api.ts`
- **lucide-react icons**: CheckCircle, AlertCircle, Shield, AlertTriangle, etc.

### Integration Points
- **Scanner.tsx**: Will import and use VulnerabilityDisplay component
- **types/index.ts**: Will extend AuditFindings type to include credentials field
- **AuditResult**: Existing type already has findings structure

## Architecture

The design follows a component composition pattern where small, focused components are composed together.

```mermaid
graph TD
    Scanner[Scanner.tsx] --> VulnerabilityDisplay[VulnerabilityDisplay.tsx]
    VulnerabilityDisplay --> FindingsCategory[FindingsCategory]
    VulnerabilityDisplay --> TransactionConfirmation[TransactionConfirmation]
    VulnerabilityDisplay --> EmptyState[VulnerabilityEmptyState]
    FindingsCategory --> FindingItem[FindingItem]
    FindingItem --> SeverityBadge[Badge component]
```

## Components and Interfaces

### VulnerabilityDisplay Component
- **Purpose:** Main container that orchestrates the vulnerability display
- **File:** `components/ui/VulnerabilityDisplay.tsx`
- **Props:**
  ```typescript
  interface VulnerabilityDisplayProps {
    findings: AuditFindings;
    riskLevel: RiskLevel;
    transactionHash?: string;
    paidAmount?: string;
  }
  ```
- **Dependencies:** FindingsCategory, TransactionConfirmation, EmptyState
- **Reuses:** Card, Badge from existing UI components

### FindingsCategory Component (internal)
- **Purpose:** Displays a single category of findings (malware, credentials, network, permissions)
- **Props:**
  ```typescript
  interface FindingsCategoryProps {
    title: string;
    icon: React.ReactNode;
    findings: string[];
    color: "green" | "yellow" | "orange" | "red";
  }
  ```
- **Dependencies:** FindingItem
- **Reuses:** None (internal component)

### FindingItem Component (internal)
- **Purpose:** Displays a single finding with severity indicator
- **Props:**
  ```typescript
  interface FindingItemProps {
    finding: string;
    severity?: "LOW" | "MEDIUM" | "HIGH" | "CRITICAL";
  }
  ```
- **Dependencies:** None
- **Reuses:** Badge component

### TransactionConfirmation Component (internal)
- **Purpose:** Displays payment confirmation with BaseScan link
- **Props:**
  ```typescript
  interface TransactionConfirmationProps {
    transactionHash: string;
    amount: string;
    network: string;
  }
  ```
- **Dependencies:** None
- **Reuses:** External link icon from lucide-react

## Data Models

### Extended AuditFindings
```typescript
interface AuditFindings {
  malware: string[];
  credentials: string[];  // Added field
  network: string[];
  permissions: string[];
}
```

### Category Configuration
```typescript
interface CategoryConfig {
  key: keyof AuditFindings;
  title: string;
  icon: React.ComponentType;
  emptyMessage: string;
  color: string;
}

const CATEGORIES: CategoryConfig[] = [
  { key: "malware", title: "Malware Detection", icon: Bug, emptyMessage: "No malware detected", color: "red" },
  { key: "credentials", title: "Credential Exposure", icon: Key, emptyMessage: "No credentials exposed", color: "orange" },
  { key: "network", title: "Network Security", icon: Globe, emptyMessage: "No network issues", color: "yellow" },
  { key: "permissions", title: "Permission Analysis", icon: Shield, emptyMessage: "No permission issues", color: "blue" },
];
```

## UI Layout

### With Vulnerabilities Found
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Audit Complete                    ID: abc123         â”‚
â”‚   Payment successful - 0.05 USDC                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚ Risk: 45/100â”‚ Level: MED  â”‚ Rec: CAUTIONâ”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ› Malware Detection                                    â”‚
â”‚   â”œâ”€ [HIGH] Suspicious eval() usage                     â”‚
â”‚   â””â”€ [MED] Dynamic code execution                       â”‚
â”‚                                                         â”‚
â”‚ ğŸ”‘ Credential Exposure                                  â”‚
â”‚   â””â”€ âœ“ No credentials exposed                           â”‚
â”‚                                                         â”‚
â”‚ ğŸŒ Network Security                                     â”‚
â”‚   â””â”€ [LOW] External API call to untrusted domain       â”‚
â”‚                                                         â”‚
â”‚ ğŸ›¡ï¸ Permission Analysis                                  â”‚
â”‚   â””â”€ âœ“ No permission issues                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’³ Transaction Confirmed                                â”‚
â”‚   0.05 USDC on Base Â· View on BaseScan â†—               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### No Vulnerabilities (Clean Scan)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Audit Complete                    ID: abc123         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚ Risk: 0/100 â”‚ Level: LOW  â”‚ Rec: SAFE   â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ğŸ›¡ï¸                                   â”‚
â”‚           No Vulnerabilities Detected                   â”‚
â”‚                                                         â”‚
â”‚   âœ“ No malware signatures found                         â”‚
â”‚   âœ“ No credential exposure detected                     â”‚
â”‚   âœ“ No suspicious network activity                      â”‚
â”‚   âœ“ No excessive permissions requested                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’³ Transaction Confirmed                                â”‚
â”‚   0.05 USDC on Base Â· View on BaseScan â†—               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling

### Error Scenarios
1. **Missing findings data**
   - **Handling:** Display empty state with "Unable to load findings"
   - **User Impact:** User sees a graceful fallback message

2. **Invalid transaction hash**
   - **Handling:** Hide transaction section, show payment amount only
   - **User Impact:** User still sees payment confirmation without link

3. **Malformed finding string**
   - **Handling:** Display raw string without severity parsing
   - **User Impact:** User sees the finding but without color coding

## Testing Strategy

### Unit Testing
- Test VulnerabilityDisplay with various findings combinations
- Test empty state rendering when all categories empty
- Test severity badge color mapping
- Test transaction link generation

### Integration Testing
- Test Scanner component integration with VulnerabilityDisplay
- Test that findings from API response render correctly

### End-to-End Testing
- Complete audit flow showing vulnerability display
- Verify transaction link opens correct BaseScan page
